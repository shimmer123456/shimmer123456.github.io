<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>UKFC逆向入门文档二 | shimmer's blog</title><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 共 $1 行","copy":"复制","copyFinish":"完成","expand":"展开"}}</script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><script>mermaid.initialize({
 startOnLoad: true
 , theme: 'dark'
});</script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="//unpkg.com/@highlightjs/cdn-assets@11.6.0/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body style="background-image:url(https://pica.zhimg.com/80/v2-521231b4ebe13d5fbfff75e801045ff2_1440w.webp?source=1940ef5c);"><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><ol class="navContent"><li class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></li><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav><div class="search-popup"><div id="search-result"></div></div></header><article><div id="post-bg"><div id="post-title"><h1>UKFC逆向入门文档二</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-10-04T06:15:19.000Z" id="date"> 2023-10-04</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-10-05T05:00:40.815Z" id="updated"> 2023-10-05</time></div></span></div></div><hr><div id="post-content"><p><em>逆向很依赖汇编的功底，所以平时要多研究研究汇编。</em></p>
<p><em>逆向题没有办法说系统学习，如果真要系统性的学习的话，那就是整个计算机领域的知识了，所以我们在初学的时候，就是以做题为主（BUU，NSS），遇到什么学什么，有足够的题量之后自然就入门了</em></p>
<h2 id="BUUCTF-ACTF新生赛2020-easyre"><a href="#BUUCTF-ACTF新生赛2020-easyre" class="headerlink" title="BUUCTF [ACTF新生赛2020]easyre"></a>BUUCTF [ACTF新生赛2020]easyre</h2><h3 id="ida的分析风格"><a href="#ida的分析风格" class="headerlink" title="ida的分析风格"></a>ida的分析风格</h3><p>初始ida分析结果：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">char</span> v4[<span class="hljs-number">12</span>]; <span class="hljs-comment">// [esp+12h] [ebp-2Eh] BYREF</span><br>  <span class="hljs-type">int</span> v5[<span class="hljs-number">3</span>]; <span class="hljs-comment">// [esp+1Eh] [ebp-22h]</span><br>  <span class="hljs-type">char</span> v6[<span class="hljs-number">5</span>]; <span class="hljs-comment">// [esp+2Ah] [ebp-16h] BYREF</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// [esp+2Fh] [ebp-11h]</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [esp+33h] [ebp-Dh]</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// [esp+37h] [ebp-9h]</span><br>  <span class="hljs-type">char</span> v10; <span class="hljs-comment">// [esp+3Bh] [ebp-5h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+3Ch] [ebp-4h]</span><br><br>  __main();<br>  qmemcpy(v4, <span class="hljs-string">&quot;*F&#x27;\&quot;N,\&quot;(I?+@&quot;</span>, <span class="hljs-keyword">sizeof</span>(v4));<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Please input:&quot;</span>);<br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, v6);<br>  <span class="hljs-keyword">if</span> ( v6[<span class="hljs-number">0</span>] != <span class="hljs-number">65</span> || v6[<span class="hljs-number">1</span>] != <span class="hljs-number">67</span> || v6[<span class="hljs-number">2</span>] != <span class="hljs-number">84</span> || v6[<span class="hljs-number">3</span>] != <span class="hljs-number">70</span> || v6[<span class="hljs-number">4</span>] != <span class="hljs-number">123</span> || v10 != <span class="hljs-number">125</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  v5[<span class="hljs-number">0</span>] = v7;<br>  v5[<span class="hljs-number">1</span>] = v8;<br>  v5[<span class="hljs-number">2</span>] = v9;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">11</span>; ++i )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( v4[i] != _data_start__[*((<span class="hljs-type">char</span> *)v5 + i) - <span class="hljs-number">1</span>] )<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;You are correct!&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>v6是一个char类型的数组，他的大小很明显不可能是5，应该是17（6+11），而ida分析错误，分析为了5个char加3个int，（5*1+3 *4也是17），所以我们可以手动更改一下v6的大小，按y键，将大小改为17即可，更改后效果如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">char</span> v4[<span class="hljs-number">12</span>]; <span class="hljs-comment">// [esp+12h] [ebp-2Eh] BYREF</span><br>  <span class="hljs-type">int</span> v5[<span class="hljs-number">3</span>]; <span class="hljs-comment">// [esp+1Eh] [ebp-22h]</span><br>  <span class="hljs-type">char</span> v6[<span class="hljs-number">17</span>]; <span class="hljs-comment">// [esp+2Ah] [ebp-16h] BYREF</span><br>  <span class="hljs-type">char</span> v7; <span class="hljs-comment">// [esp+3Bh] [ebp-5h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+3Ch] [ebp-4h]</span><br><br>  __main();<br>  qmemcpy(v4, <span class="hljs-string">&quot;*F&#x27;\&quot;N,\&quot;(I?+@&quot;</span>, <span class="hljs-keyword">sizeof</span>(v4));<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Please input:&quot;</span>);<br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, v6);<br>  <span class="hljs-keyword">if</span> ( v6[<span class="hljs-number">0</span>] != <span class="hljs-number">65</span> || v6[<span class="hljs-number">1</span>] != <span class="hljs-number">67</span> || v6[<span class="hljs-number">2</span>] != <span class="hljs-number">84</span> || v6[<span class="hljs-number">3</span>] != <span class="hljs-number">70</span> || v6[<span class="hljs-number">4</span>] != <span class="hljs-number">123</span> || v7 != <span class="hljs-number">125</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  v5[<span class="hljs-number">0</span>] = *(_DWORD *)&amp;v6[<span class="hljs-number">5</span>];<br>  v5[<span class="hljs-number">1</span>] = *(_DWORD *)&amp;v6[<span class="hljs-number">9</span>];<br>  v5[<span class="hljs-number">2</span>] = *(_DWORD *)&amp;v6[<span class="hljs-number">13</span>];<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">11</span>; ++i )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( v4[i] != _data_start__[*((<span class="hljs-type">char</span> *)v5 + i) - <span class="hljs-number">1</span>] )<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;You are correct!&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这个时候v7，8，9就消失了，成为了v6数组内的一部分，更好看</p>
<p>再说一下这个部分：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">11</span>; ++i )<br> &#123;<br>   <span class="hljs-keyword">if</span> ( v4[i] != _data_start__[*((<span class="hljs-type">char</span> *)v5 + i) - <span class="hljs-number">1</span>] )<br>     <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br> &#125;<br></code></pre></td></tr></table></figure>

<p>v5可以看到上面的定义为int类型，而在下面的if条件中，左边是v4数组，是char类型的，右边是v5，它本身是int类型的，并且调用他的方法是v5+i，即数组首元素地址加偏移量的方式。（说到这，插一句：c语言中的指针知识在初学逆向时是很重要的）前面还有一个（char*），这个就是强制类型转换，将一个int *的v5强制按照char *的方式来读取其内存中的东西，这样就可以按照一个字节的方式依次取出v5里存放的东西了</p>
<h3 id="简单逻辑逆向"><a href="#简单逻辑逆向" class="headerlink" title="简单逻辑逆向"></a>简单逻辑逆向</h3><p>解密脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">v4 = [<span class="hljs-number">42</span>,<span class="hljs-number">70</span>,<span class="hljs-number">39</span>,<span class="hljs-number">34</span>,<span class="hljs-number">78</span>,<span class="hljs-number">44</span>,<span class="hljs-number">34</span>,<span class="hljs-number">40</span>,<span class="hljs-number">73</span>,<span class="hljs-number">63</span>,<span class="hljs-number">43</span>,<span class="hljs-number">64</span>]<br> <br>model = <span class="hljs-string">r&quot;&#125;|&#123;zyxwvutsrqponmlkjihgfedcba`_^]\[ZYXWVUTSRQPONMLKJIHGFEDCBA@?&gt;=&lt;;:9876543210/.-,+*)(&quot;</span> + <span class="hljs-built_in">chr</span>(<span class="hljs-number">0x27</span>) + <span class="hljs-string">r&#x27;&amp;%$# !&quot;&#x27;</span><br> <br>pos = []<br> <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> v4:<br>    pos.append(model.find(<span class="hljs-built_in">chr</span>(i))+<span class="hljs-number">1</span>)<br>s = [<span class="hljs-built_in">chr</span>(x + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> pos]<br>flag = <span class="hljs-string">&#x27;&#x27;</span>.join(s)<br><span class="hljs-built_in">print</span> (<span class="hljs-string">&#x27;flag&#123;&#x27;</span>+flag+<span class="hljs-string">&#x27;&#125;&#x27;</span>)<br></code></pre></td></tr></table></figure>

<h2 id="BUUCTF-GXYCTF2019-luck-guy"><a href="#BUUCTF-GXYCTF2019-luck-guy" class="headerlink" title="BUUCTF [GXYCTF2019]luck_guy"></a>BUUCTF [GXYCTF2019]luck_guy</h2><h3 id="linux远程动调"><a href="#linux远程动调" class="headerlink" title="linux远程动调"></a>linux远程动调</h3><p>linux端：</p>
<ul>
<li>将ida文件下IDA_Pro_7.7\dbgsrv文件夹下的linux_server（64）放到linux里</li>
<li>查看linux的ip：ifconfig</li>
<li>给权限：chmod 777 linux_server64</li>
<li>运行：.&#x2F;linux_server64</li>
</ul>
<p>windows端：</p>
<ul>
<li>f9：remote linux debugger</li>
<li>hostname里填写刚刚查到的ip地址，其余不用管</li>
</ul>
<p>动调起来后就可以<strong>随意修改</strong>代码逻辑</p>
<h3 id="简单逻辑逆向-1"><a href="#简单逻辑逆向-1" class="headerlink" title="简单逻辑逆向"></a>简单逻辑逆向</h3><p>初步看逻辑，就是他定义了一个随机数，这个随机数必须先走case4，再走case5，最后走case1，就可以成功的把flag打印出来，那么到这里就有两个思路，一个是仿写一下case4，5的代码逻辑，另一种是让程序执行到case4那里，再执行case5，1，让他自己把flag打印出来</p>
<p>修改代码需要在汇编层面，汇编可以尝试啃啃书或者视频课，但重要的是多看。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">flag=<span class="hljs-string">&quot;GXY&#123;do_not_&quot;</span><br>f2=[<span class="hljs-number">0x7F</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0x6F</span>,<span class="hljs-number">0x60</span>,<span class="hljs-number">0x67</span>,<span class="hljs-number">0x75</span>,<span class="hljs-number">0x63</span>,<span class="hljs-number">0x69</span>][::-<span class="hljs-number">1</span>] <span class="hljs-comment">#小端序的问题，所以要逆序一下</span><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>    <span class="hljs-keyword">if</span> j%<span class="hljs-number">2</span>==<span class="hljs-number">1</span> :<br>        s=<span class="hljs-built_in">chr</span>(f2[j]-<span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">else</span>:<br>        s=<span class="hljs-built_in">chr</span>(f2[j]-<span class="hljs-number">1</span>)<br>    flag+=s<br><span class="hljs-built_in">print</span> (flag)<br></code></pre></td></tr></table></figure>

<h2 id="NSSCTF-GDOUCTF-2023-Check-Your-Luck"><a href="#NSSCTF-GDOUCTF-2023-Check-Your-Luck" class="headerlink" title="NSSCTF [GDOUCTF 2023]Check_Your_Luck"></a>NSSCTF [GDOUCTF 2023]Check_Your_Luck</h2><h3 id="z3"><a href="#z3" class="headerlink" title="z3"></a>z3</h3><p>简单，就是学习一下z3这个工具的使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<br>s = Solver()<br>v , w, x, y ,z = Ints(<span class="hljs-string">&#x27;v w x y z&#x27;</span>)<br>s.add(v * <span class="hljs-number">23</span> + w * -<span class="hljs-number">32</span> + x * <span class="hljs-number">98</span> + y * <span class="hljs-number">55</span> + z * <span class="hljs-number">90</span> == <span class="hljs-number">333322</span>)<br>s.add(v * <span class="hljs-number">123</span> + w * -<span class="hljs-number">322</span> + x * <span class="hljs-number">68</span> + y * <span class="hljs-number">67</span> + z * <span class="hljs-number">32</span> == <span class="hljs-number">707724</span>)<br>s.add(v * <span class="hljs-number">266</span> + w * -<span class="hljs-number">34</span> + x * <span class="hljs-number">43</span> + y * <span class="hljs-number">8</span> + z * <span class="hljs-number">32</span> == <span class="hljs-number">1272529</span>)<br>s.add(v * <span class="hljs-number">343</span> + w * -<span class="hljs-number">352</span> + x * <span class="hljs-number">58</span> + y * <span class="hljs-number">65</span> + z * <span class="hljs-number">5</span> == <span class="hljs-number">1672457</span>)<br>s.add(v * <span class="hljs-number">231</span> + w * -<span class="hljs-number">321</span> + x * <span class="hljs-number">938</span> + y * <span class="hljs-number">555</span> + z * <span class="hljs-number">970</span> == <span class="hljs-number">3372367</span>)<br><span class="hljs-keyword">if</span> s.check() == sat:<br>    <span class="hljs-built_in">print</span>(s.model())<br><span class="hljs-comment">#NSSCTF&#123;4544_123_677_1754_777&#125;</span><br></code></pre></td></tr></table></figure>

<h2 id="NSSCTF-LitCTF-2023-程序和人有一个能跑就行了"><a href="#NSSCTF-LitCTF-2023-程序和人有一个能跑就行了" class="headerlink" title="NSSCTF [LitCTF 2023]程序和人有一个能跑就行了"></a>NSSCTF [LitCTF 2023]程序和人有一个能跑就行了</h2><h3 id="隐藏逻辑-动态调试"><a href="#隐藏逻辑-动态调试" class="headerlink" title="隐藏逻辑(动态调试)"></a>隐藏逻辑(动态调试)</h3><h3 id="RC4"><a href="#RC4" class="headerlink" title="RC4"></a>RC4</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Moomin/p/15023601.html">RC4加密算法与逆向方法简析 - Moominn - 博客园 (cnblogs.com)</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">RC4INFO</span></span><br><span class="hljs-class">&#123;</span><br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> s_box[<span class="hljs-number">256</span>];<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> t_box[<span class="hljs-number">256</span>];<br>&#125;RC4_INFO, * PRC4_INFO;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">rc4_init</span><span class="hljs-params">(PRC4_INFO prc4, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> key[], <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> keylen)</span><br>&#123;<br>	<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br>	<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>;<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> tmp;<br>	<span class="hljs-keyword">if</span> (prc4 == <span class="hljs-literal">NULL</span>)<br>	&#123;<br>		<span class="hljs-keyword">return</span>;<br>	&#125;<br>	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++)<br>	&#123;<br>		prc4-&gt;s_box[i] = i;<br>		prc4-&gt;t_box[i] = key[i % keylen];<br>	&#125;<br>	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++)<br>	&#123;<br>		j = (j + prc4-&gt;s_box[i] + prc4-&gt;t_box[i]) % <span class="hljs-number">256</span>;<br>		tmp = prc4-&gt;s_box[i];<br>		prc4-&gt;s_box[i] = prc4-&gt;s_box[j];<br>		prc4-&gt;s_box[j] = tmp;<br>	&#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">rc4_crypt</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> data[], <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> datalen, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> key[], <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> keylen)</span><br>&#123;<br>	<span class="hljs-type">int</span> dn = <span class="hljs-number">0</span>;<br>	<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br>	<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>;<br>	<span class="hljs-type">int</span> t = <span class="hljs-number">0</span>;<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> tmp;<br><br>	RC4_INFO rc4;<br>	rc4_init(&amp;rc4, key, keylen);<br><br>	<span class="hljs-keyword">for</span> (dn = <span class="hljs-number">0</span>; dn &lt; datalen; dn++)<br>	&#123;<br>		i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>;<br>		j = (j + rc4.s_box[i]) % <span class="hljs-number">256</span>;<br>        <br>		tmp = rc4.s_box[i];<br>		rc4.s_box[i] = rc4.s_box[j];<br>		rc4.s_box[j] = tmp;<br><br>		t = (rc4.s_box[i] + rc4.s_box[j]) % <span class="hljs-number">256</span>;<br>		data[dn] ^= rc4.s_box[t];<br>	&#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">EntryBuffer</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> data[], <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> datalen)</span><br>&#123;<br>	<span class="hljs-comment">//注意这两种写法需要-1的区别</span><br>	<span class="hljs-comment">//unsigned char key[] =&#123; 108,105,116,99,116,102 &#125;;//key</span><br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> key[] = <span class="hljs-string">&quot;litctf&quot;</span>;<br>	rc4_crypt(data, datalen, key, <span class="hljs-keyword">sizeof</span>(key) / <span class="hljs-keyword">sizeof</span>(key[<span class="hljs-number">0</span>])<span class="hljs-number">-1</span>);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> Hell[] = &#123; <span class="hljs-number">0x8D</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0xB7</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x99</span>,<span class="hljs-number">0x35</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0xB0</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0xD1</span> &#125;;<br>	<br>	<span class="hljs-comment">//密文或者是原文</span><br><br>	EntryBuffer((<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>*)Hell, <span class="hljs-keyword">sizeof</span>(Hell) / <span class="hljs-keyword">sizeof</span>(Hell[<span class="hljs-number">0</span>]));<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">28</span>; i++)<br>	&#123;<br>		<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, Hell[i]);<br>	&#125;<br>	<span class="hljs-comment">//EntryBuffer((unsigned char*)Hell, sizeof(Hell) / sizeof(Hell[0])); //由于异或运算的对合性，RC4加密解密使用同一套算法。</span><br>	<span class="hljs-comment">//printf(&quot;解密后：pData=%s\n\n&quot;, Hell);</span><br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="GDOUCTF-2023-doublegame"><a href="#GDOUCTF-2023-doublegame" class="headerlink" title="[GDOUCTF 2023]doublegame"></a>[GDOUCTF 2023]doublegame</h2><h3 id="交叉引用"><a href="#交叉引用" class="headerlink" title="交叉引用"></a>交叉引用</h3><h3 id="动态调试"><a href="#动态调试" class="headerlink" title="动态调试"></a>动态调试</h3><p>直接运行程序是一个贪吃蛇游戏，撞壁游戏就结束了。</p>
<p>拖入ida，因为没有main函数，所以通过字符串来定位关键逻辑：</p>
<p><img src="https://raw.githubusercontent.com/shimmer123456/img/main/img/202305192204997.png" alt="image-20230519220455865"></p>
<p>看到挺多0，跟进去，来到了这么一个函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> __noreturn <span class="hljs-title function_">sub_140012CF0</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">char</span> *v0; <span class="hljs-comment">// rdi</span><br>  __int64 i; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">char</span> v2; <span class="hljs-comment">// [rsp+20h] [rbp+0h] BYREF</span><br>  <span class="hljs-type">char</span> Buffer[<span class="hljs-number">22</span>]; <span class="hljs-comment">// [rsp+30h] [rbp+10h] BYREF</span><br>  <span class="hljs-type">char</span> v4[<span class="hljs-number">44</span>]; <span class="hljs-comment">// [rsp+46h] [rbp+26h] BYREF</span><br>  <span class="hljs-type">char</span> v5[<span class="hljs-number">44</span>]; <span class="hljs-comment">// [rsp+72h] [rbp+52h] BYREF</span><br>  <span class="hljs-type">char</span> v6[<span class="hljs-number">44</span>]; <span class="hljs-comment">// [rsp+9Eh] [rbp+7Eh] BYREF</span><br>  <span class="hljs-type">char</span> v7[<span class="hljs-number">44</span>]; <span class="hljs-comment">// [rsp+CAh] [rbp+AAh] BYREF</span><br>  <span class="hljs-type">char</span> v8[<span class="hljs-number">44</span>]; <span class="hljs-comment">// [rsp+F6h] [rbp+D6h] BYREF</span><br>  <span class="hljs-type">char</span> v9[<span class="hljs-number">44</span>]; <span class="hljs-comment">// [rsp+122h] [rbp+102h] BYREF</span><br>  <span class="hljs-type">char</span> v10[<span class="hljs-number">44</span>]; <span class="hljs-comment">// [rsp+14Eh] [rbp+12Eh] BYREF</span><br>  <span class="hljs-type">char</span> v11[<span class="hljs-number">44</span>]; <span class="hljs-comment">// [rsp+17Ah] [rbp+15Ah] BYREF</span><br>  <span class="hljs-type">char</span> v12[<span class="hljs-number">44</span>]; <span class="hljs-comment">// [rsp+1A6h] [rbp+186h] BYREF</span><br>  <span class="hljs-type">char</span> v13[<span class="hljs-number">66</span>]; <span class="hljs-comment">// [rsp+1D2h] [rbp+1B2h] BYREF</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+214h] [rbp+1F4h]</span><br>  <span class="hljs-type">int</span> v15; <span class="hljs-comment">// [rsp+234h] [rbp+214h]</span><br>  <span class="hljs-type">int</span> v16; <span class="hljs-comment">// [rsp+254h] [rbp+234h]</span><br>  <span class="hljs-type">int</span> v17; <span class="hljs-comment">// [rsp+274h] [rbp+254h]</span><br>  <span class="hljs-type">int</span> v18; <span class="hljs-comment">// [rsp+294h] [rbp+274h]</span><br>  _DWORD v19[<span class="hljs-number">25</span>]; <span class="hljs-comment">// [rsp+2C0h] [rbp+2A0h] BYREF</span><br>  <span class="hljs-type">char</span> v20[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [rsp+324h] [rbp+304h] BYREF</span><br>  <span class="hljs-type">char</span> v21[<span class="hljs-number">828</span>]; <span class="hljs-comment">// [rsp+388h] [rbp+368h] BYREF</span><br>  <span class="hljs-type">char</span> v22; <span class="hljs-comment">// [rsp+6C4h] [rbp+6A4h]</span><br>  <span class="hljs-type">int</span> v23; <span class="hljs-comment">// [rsp+6E4h] [rbp+6C4h]</span><br>  <span class="hljs-type">int</span> v24; <span class="hljs-comment">// [rsp+704h] [rbp+6E4h]</span><br><br>  v0 = &amp;v2;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">448</span>i64; i; --i )<br>  &#123;<br>    *(_DWORD *)v0 = <span class="hljs-number">-858993460</span>;<br>    v0 += <span class="hljs-number">4</span>;<br>  &#125;<br>  sub_14001141A(&amp;unk_1400290A6);<br>  <span class="hljs-built_in">strcpy</span>(Buffer, <span class="hljs-string">&quot;000000000000000000000&quot;</span>);<br>  <span class="hljs-built_in">strcpy</span>(v4, <span class="hljs-string">&quot;0 0 0 0     0     0 0&quot;</span>);<br>  <span class="hljs-built_in">strcpy</span>(&amp;v4[<span class="hljs-number">22</span>], <span class="hljs-string">&quot;0 0 0 00000 00000 0 0&quot;</span>);<br>  <span class="hljs-built_in">strcpy</span>(v5, <span class="hljs-string">&quot;0 0               0 0&quot;</span>);<br>  <span class="hljs-built_in">strcpy</span>(&amp;v5[<span class="hljs-number">22</span>], <span class="hljs-string">&quot;0 000 000 0 000 0 0 0&quot;</span>);<br>  <span class="hljs-built_in">strcpy</span>(v6, <span class="hljs-string">&quot;0 0     0 0 0   0 0 0&quot;</span>);<br>  <span class="hljs-built_in">strcpy</span>(&amp;v6[<span class="hljs-number">22</span>], <span class="hljs-string">&quot;0 0 0 00000 000 000 0&quot;</span>);<br>  <span class="hljs-built_in">strcpy</span>(v7, <span class="hljs-string">&quot;0 0 0     0   0 0    &quot;</span>);<br>  <span class="hljs-built_in">strcpy</span>(&amp;v7[<span class="hljs-number">22</span>], <span class="hljs-string">&quot;0 000 0 0 000 0 0 0 0&quot;</span>);<br>  <span class="hljs-built_in">strcpy</span>(v8, <span class="hljs-string">&quot;0     0 0 0 0 0 0 0 0&quot;</span>);<br>  <span class="hljs-built_in">strcpy</span>(&amp;v8[<span class="hljs-number">22</span>], <span class="hljs-string">&quot;0 00000 000 000 0 0 0&quot;</span>);<br>  <span class="hljs-built_in">strcpy</span>(v9, <span class="hljs-string">&quot;0     0       0   0 0&quot;</span>);<br>  <span class="hljs-built_in">strcpy</span>(&amp;v9[<span class="hljs-number">22</span>], <span class="hljs-string">&quot;000 0 0 0 000 0 0 0 0&quot;</span>);<br>  <span class="hljs-built_in">strcpy</span>(v10, <span class="hljs-string">&quot;0 0 0 0 0 0 * 0 0 0 0&quot;</span>);<br>  <span class="hljs-built_in">strcpy</span>(&amp;v10[<span class="hljs-number">22</span>], <span class="hljs-string">&quot;0 0000000 0 000 00000&quot;</span>);<br>  <span class="hljs-built_in">strcpy</span>(v11, <span class="hljs-string">&quot;@       0 0         0&quot;</span>);<br>  <span class="hljs-built_in">strcpy</span>(&amp;v11[<span class="hljs-number">22</span>], <span class="hljs-string">&quot;0 0 0 0 0 00000000000&quot;</span>);<br>  <span class="hljs-built_in">strcpy</span>(v12, <span class="hljs-string">&quot;0 0 0 0             0&quot;</span>);<br>  <span class="hljs-built_in">strcpy</span>(&amp;v12[<span class="hljs-number">22</span>], <span class="hljs-string">&quot;000 0 00000 0 000 000&quot;</span>);<br>  <span class="hljs-built_in">strcpy</span>(v13, <span class="hljs-string">&quot;0         0 0   0   0&quot;</span>);<br>  <span class="hljs-built_in">strcpy</span>(&amp;v13[<span class="hljs-number">22</span>], <span class="hljs-string">&quot;000000000000000000000&quot;</span>);<br>  v11[<span class="hljs-number">4</span>] = <span class="hljs-number">48</span>;<br>  <span class="hljs-built_in">strcpy</span>((<span class="hljs-type">char</span> *)v19, <span class="hljs-string">&quot;Please to save the cat!&quot;</span>);<br>  <span class="hljs-built_in">memset</span>(&amp;v19[<span class="hljs-number">6</span>], <span class="hljs-number">0</span>, <span class="hljs-number">0x4C</span>ui64);<br>  <span class="hljs-built_in">strcpy</span>(v20, <span class="hljs-string">&quot;the score is saving cat&#x27;s key!\n&quot;</span>);<br>  <span class="hljs-built_in">memset</span>(&amp;v20[<span class="hljs-number">32</span>], <span class="hljs-number">0</span>, <span class="hljs-number">0x44</span>ui64);<br>  qmemcpy(v21, &amp;unk_14001D340, <span class="hljs-number">0x47</span>ui64);<br>  <span class="hljs-built_in">memset</span>(&amp;v21[<span class="hljs-number">71</span>], <span class="hljs-number">0</span>, <span class="hljs-number">729</span>);<br>  sub_1400111F9(<span class="hljs-string">&quot;path\n&quot;</span>);<br>  v23 = <span class="hljs-number">0</span>;<br>  v24 = <span class="hljs-number">0</span>;<br>  v15 = <span class="hljs-number">15</span>;<br>  v16 = <span class="hljs-number">0</span>;<br>  v17 = <span class="hljs-number">7</span>;<br>  v18 = <span class="hljs-number">20</span>;<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">20</span>; ++j )<br>    <span class="hljs-built_in">puts</span>(&amp;Buffer[<span class="hljs-number">22</span> * j]);<br>  sub_1400111F9(<span class="hljs-string">&quot;Please to save the cat!\n&quot;</span>);<br>  <span class="hljs-keyword">while</span> ( v15 != v17 || v16 != v18 )<br>  &#123;<br>    v22 = getchar();<br>    <span class="hljs-keyword">switch</span> ( v22 )<br>    &#123;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;s&#x27;</span>:<br>        <span class="hljs-keyword">if</span> ( Buffer[<span class="hljs-number">22</span> * v15 + <span class="hljs-number">22</span> + v16] != <span class="hljs-number">48</span> )<br>        &#123;<br>          Buffer[<span class="hljs-number">22</span> * v15++ + v16] = <span class="hljs-number">32</span>;<br>          Buffer[<span class="hljs-number">22</span> * v15 + v16] = <span class="hljs-number">64</span>;<br>        &#125;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;w&#x27;</span>:<br>        <span class="hljs-keyword">if</span> ( Buffer[<span class="hljs-number">22</span> * v15 - <span class="hljs-number">22</span> + v16] != <span class="hljs-number">48</span> )<br>        &#123;<br>          Buffer[<span class="hljs-number">22</span> * v15-- + v16] = <span class="hljs-number">32</span>;<br>          Buffer[<span class="hljs-number">22</span> * v15 + v16] = <span class="hljs-number">64</span>;<br>        &#125;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;a&#x27;</span>:<br>        <span class="hljs-keyword">if</span> ( Buffer[<span class="hljs-number">22</span> * v15 - <span class="hljs-number">1</span> + v16] != <span class="hljs-number">48</span> )<br>        &#123;<br>          <span class="hljs-keyword">if</span> ( Buffer[<span class="hljs-number">22</span> * v15 - <span class="hljs-number">1</span> + v16] == <span class="hljs-number">42</span> )<br>            v7[<span class="hljs-number">20</span>] = <span class="hljs-number">48</span>;<br>          Buffer[<span class="hljs-number">22</span> * v15 + v16--] = <span class="hljs-number">32</span>;<br>          Buffer[<span class="hljs-number">22</span> * v15 + v16] = <span class="hljs-number">64</span>;<br>        &#125;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">default</span>:<br>        <span class="hljs-keyword">if</span> ( v22 == <span class="hljs-number">100</span> &amp;&amp; Buffer[<span class="hljs-number">22</span> * v15 + <span class="hljs-number">1</span> + v16] != <span class="hljs-number">48</span> )<br>        &#123;<br>          Buffer[<span class="hljs-number">22</span> * v15 + v16++] = <span class="hljs-number">32</span>;<br>          Buffer[<span class="hljs-number">22</span> * v15 + v16] = <span class="hljs-number">64</span>;<br>        &#125;<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>    system(<span class="hljs-string">&quot;cls&quot;</span>);<br>    <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">20</span>; ++j )<br>      <span class="hljs-built_in">puts</span>(&amp;Buffer[<span class="hljs-number">22</span> * j]);<br>    <span class="hljs-built_in">puts</span>((<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)&amp;v19[<span class="hljs-number">25</span> * v23]);<br>    <span class="hljs-keyword">if</span> ( v7[<span class="hljs-number">20</span>] == <span class="hljs-number">48</span> )<br>    &#123;<br>      v24 = sub_140011433(<span class="hljs-number">0</span>i64);<br>      <span class="hljs-keyword">if</span> ( v24 == <span class="hljs-number">13376013</span> )<br>      &#123;<br>        v23 = <span class="hljs-number">1</span>;<br>        v7[<span class="hljs-number">20</span>] = <span class="hljs-number">32</span>;<br>        Buffer[<span class="hljs-number">22</span> * v15 + v16] = <span class="hljs-number">32</span>;<br>        v15 = <span class="hljs-number">15</span>;<br>        v16 = <span class="hljs-number">0</span>;<br>        v11[<span class="hljs-number">0</span>] = <span class="hljs-number">64</span>;<br>        ++v23;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        sub_1400111F9(<span class="hljs-string">&quot;error&quot;</span>);<br>      &#125;<br>    &#125;<br>  &#125;<br>  system(<span class="hljs-string">&quot;cls&quot;</span>);<br>  Sleep(<span class="hljs-number">0x1F4</span>u);<br>  Sleep(<span class="hljs-number">0xBB8</span>u);<br>  sub_140011492();<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>很明显是一个迷宫，但刚才的贪吃蛇哪去了（因为是double game啦），那么就再交叉引用看看谁调用了这个迷宫的函数，一直可以追到贪吃蛇游戏里：</p>
<p><img src="https://raw.githubusercontent.com/shimmer123456/img/main/img/202305192205535.png" alt="image-20230519220541425"></p>
<p>这个dword_140022CD0就是当前得分了，当它＞13371337时就会跳转到迷宫游戏</p>
<p>逻辑清楚了，那么在判断分数前下个断点，贪吃蛇游戏结束之后断下来，修改两次标志位（sf）跳转到迷宫游戏</p>
<p>接下来通过wsad控制上下左右走迷宫，先把小猫救出来后，程序会让输入key（其实就是贪吃蛇分数13371337），也可以通过判断key的逻辑再把key逆出来：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> ( v7[<span class="hljs-number">20</span>] == <span class="hljs-string">&#x27;0&#x27;</span> )<br>   &#123;<br>     v25 = sub_7FF777D31433(<span class="hljs-number">0</span>i64);<br>     <span class="hljs-keyword">if</span> ( v25 == <span class="hljs-number">13376013</span> )<br></code></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">sub_7FF777D31E10</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> a1)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v2; <span class="hljs-comment">// [rsp+120h] [rbp+100h] BYREF</span><br><br>  v2 = a1;<br>  sub_7FF777D3141A(&amp;unk_7FF777D490A6);<br>  sub_7FF777D311F9(<span class="hljs-string">&quot;do you know the key to open the door\n&quot;</span>);<br>  sub_7FF777D3126C(<span class="hljs-string">&quot;%d&quot;</span>, &amp;v2);<br>  v2 ^= <span class="hljs-number">0x1DC4</span>u;<br>  <span class="hljs-keyword">return</span> v2;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>所以为了使v25&#x3D;13376013，需要v2^0x1dc4&#x3D;13376013,那么key就是13376013^13376013&#x3D;13371337</p>
<p>输入key之后，又回到原点了，再走一下迷宫，flag就是{key+md5(最短路径)}</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/10/21/UKFC%E9%80%86%E5%90%91%E5%85%A5%E9%97%A8%E6%96%87%E6%A1%A3%E4%B8%89/">← Next UKFC逆向入门文档三</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/09/25/UKFC%E9%80%86%E5%90%91%E5%85%A5%E9%97%A8%E6%96%87%E6%A1%A3%E4%B8%80/">UKFC逆向入门文档一 Prev →</a></div></div></div><div id="Valine"></div></div><div id="bottom-btn"><a id="to-index" href="#toc-div" title="INDEX">≡</a><a id="to-top" onClick="scrolls.scrolltop();" title="to top" style="opacity: 0; display: none;">∧</a></div></article><aside><div id="aside-top"><div id="about"><a href="/" id="logo"><img src="https://raw.githubusercontent.com/shimmer123456/img/main/img/touxiang.png" alt="Logo"></a><h1 id="Dr"><a href="/">shimmer</a></h1><div id="description"><p>一</p><p>些</p><p>小</p><p>笔</p><p>记</p><p>或</p><p>是</p><p>小</p><p>感</p><p>悟</p></div></div><div id="aside-block"><div id="toc-div"><h1>INDEX</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#BUUCTF-ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020-easyre"><span class="toc-number">1.</span> <span class="toc-text">BUUCTF [ACTF新生赛2020]easyre</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ida%E7%9A%84%E5%88%86%E6%9E%90%E9%A3%8E%E6%A0%BC"><span class="toc-number">1.1.</span> <span class="toc-text">ida的分析风格</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E9%80%BB%E8%BE%91%E9%80%86%E5%90%91"><span class="toc-number">1.2.</span> <span class="toc-text">简单逻辑逆向</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BUUCTF-GXYCTF2019-luck-guy"><span class="toc-number">2.</span> <span class="toc-text">BUUCTF [GXYCTF2019]luck_guy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#linux%E8%BF%9C%E7%A8%8B%E5%8A%A8%E8%B0%83"><span class="toc-number">2.1.</span> <span class="toc-text">linux远程动调</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E9%80%BB%E8%BE%91%E9%80%86%E5%90%91-1"><span class="toc-number">2.2.</span> <span class="toc-text">简单逻辑逆向</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSCTF-GDOUCTF-2023-Check-Your-Luck"><span class="toc-number">3.</span> <span class="toc-text">NSSCTF [GDOUCTF 2023]Check_Your_Luck</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#z3"><span class="toc-number">3.1.</span> <span class="toc-text">z3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSCTF-LitCTF-2023-%E7%A8%8B%E5%BA%8F%E5%92%8C%E4%BA%BA%E6%9C%89%E4%B8%80%E4%B8%AA%E8%83%BD%E8%B7%91%E5%B0%B1%E8%A1%8C%E4%BA%86"><span class="toc-number">4.</span> <span class="toc-text">NSSCTF [LitCTF 2023]程序和人有一个能跑就行了</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%90%E8%97%8F%E9%80%BB%E8%BE%91-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95"><span class="toc-number">4.1.</span> <span class="toc-text">隐藏逻辑(动态调试)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RC4"><span class="toc-number">4.2.</span> <span class="toc-text">RC4</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GDOUCTF-2023-doublegame"><span class="toc-number">5.</span> <span class="toc-text">[GDOUCTF 2023]doublegame</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E5%8F%89%E5%BC%95%E7%94%A8"><span class="toc-number">5.1.</span> <span class="toc-text">交叉引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95"><span class="toc-number">5.2.</span> <span class="toc-text">动态调试</span></a></li></ol></li></ol></div></div></div><footer><nobr>published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknight</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script class="pjax-js">reset=_=>{new Valine({
 el: '#Valine'
 , appId: 'fvW1eWgLvTdXfECCW1Bu9g6J-gzGzoHsz'
 , appKey: 'stD8FmxHNFFxhkzXholoBHdq' , placeholder: '此条评论委托企鹅物流发送'
});code.findCode();mermaid.init(undefined, ('.mermaid'));}</script><script src="/js/arknights.js"></script><script>window.addEventListener("load",()=>{reset()})</script></body></html>